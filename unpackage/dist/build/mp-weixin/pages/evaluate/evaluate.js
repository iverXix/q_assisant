(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/evaluate/evaluate"],{3181:function(e,t,n){"use strict";n.r(t);var i=n("8e3a"),u=n("4e87");for(var o in u)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(o);n("99f2");var l=n("f0c5"),s=Object(l["a"])(u["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=s.exports},"4e87":function(e,t,n){"use strict";n.r(t);var i=n("9411"),u=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=u.a},5619:function(e,t,n){"use strict";(function(e){var t=n("4ea4");n("1fb8"),n("a9ff");t(n("66fd"));var i=t(n("3181"));wx.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("543d")["createPage"])},"8e3a":function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"390f"))},uniRate:function(){return n.e("uni_modules/uni-rate/components/uni-rate/uni-rate").then(n.bind(null,"31de"))},uniFilePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(n.bind(null,"ae7b"))},uniListItem:function(){return n.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(n.bind(null,"696c"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"4fbd"))}},u=function(){var e=this.$createElement;this._self._c},o=[]},9411:function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{arr:[],_s_name:"",rateValue:0,value2:"",list:[],selectId:[],pinlun_item:{s_name:"",content:"",all_score:this.rateValue,imageValue:[],user_id:"",nickname:"",avatarUrl:"",u_level:""}}},methods:{onChange:function(e){this.pinlun_item.all_score=e.value},choice:function(e){if(1==this.list[e].selected){this.list[e].selected=!1;for(var t=0;t<this.selectId.length;t++)this.selectId[t]===this.list[e].title&&this.selectId.splice(t,1)}else this.list[e].selected=!0,this.selectId.push(this.list[e].title)},select:function(){},success:function(e){console.log(this.pinlun_item.imageValue)},showFoodName:function(t){var n=this;this.pinlun_item.s_name=this._s_name=JSON.parse(t.s_name);var i={s_name:this._s_name},u=e.database();u.collection("food").where(i).get().then((function(e){var t=e.result.data;n.list=t.map((function(e,t){return Object.assign({},{title:e.f_name})}))})).catch((function(e){console.log(e)}))},get:function(e){this.pinlun_item.content=e},submit:function(){var t=this;if(""!=this.pinlun_item.content&&""!=this.pinlun_item.all_score){for(var i=function(){var n={f_name:t.selectId[u]},i=e.database();i.collection("food").where(n).get().then((function(e){var t=e.result.data[0].f_recom,n={_id:e.result.data[0]._id};i.collection("food").where(n).update({f_recom:t+1}).catch((function(e){console.log(e)}))}))},u=0;u<this.selectId.length;u++)i();var o=e.database();o.collection("food-evaluate").add(this.pinlun_item).then((function(e){})).catch((function(e){console.log(e)}));var l={_id:this.pinlun_item.user_id},s={user_id:this.pinlun_item.user_id};o.collection("uni-id-users").where(l).get().then((function(e){var n=e.result.data[0].score,i=t.pinlun_item.imageValue.length;0!==i?o.collection("uni-id-users").where(l).update({score:n+2,new_score:n+2}).catch((function(e){console.log(e)})):(o.collection("uni-id-users").where(l).update({score:n+1,new_score:n+1}),o.collection("uni-id-users").where(l).get().then((function(e){var t=e.result.data[0].score;console.log(t),t<=30?(o.collection("uni-id-users").where(l).update({u_level:"初级级鉴赏官"}),o.collection("food-evaluate").where(s).update({u_level:"初级级鉴赏官"})):t>30&&t<=50?(o.collection("uni-id-users").where(l).update({u_level:"中级鉴赏官"}),o.collection("food-evaluate").where(s).update({u_level:"中级鉴赏官"})):(o.collection("uni-id-users").where(l).update({u_level:"高级鉴赏官"}),o.collection("food-evaluate").where(s).update({u_level:"高级鉴赏官"}))})))})),n.redirectTo({url:"/pages/shop/shop?s_name="+this._s_name})}else n.showToast({title:"请为档口打分或填写相应评价内容",icon:"none"})},getuser:function(){var t=this;n.getStorage({key:"user",success:function(n){t.pinlun_item.user_id=n.data.user._id,t.pinlun_item.nickname=n.data.user.nickName,t.pinlun_item.avatarUrl=n.data.user.avatarUrl;var i={_id:t.pinlun_item.user_id},u=e.database();console.log(i),u.collection("uni-id-users").where(i).get().then((function(e){t.pinlun_item.u_level=e.result.data[0].u_level}))}})},onLoad:function(e){this.showFoodName(e),this.getuser()}}};t.default=i}).call(this,n("a9ff")["default"],n("543d")["default"])},"99f2":function(e,t,n){"use strict";var i=n("ddb1"),u=n.n(i);u.a},ddb1:function(e,t,n){}},[["5619","common/runtime","common/vendor"]]]);