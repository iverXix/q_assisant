(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/coupon/coupon"],{"254a":function(n,e,t){"use strict";(function(n,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{gutter:0,coupon:{_id:"",c_name:"",c_time:"",c_score:"",c_price:"",c_term:""},userInfo:{id:""},newscore:"",u_id:"",value:0,range:[{value:0,text:"新港区"},{value:1,text:"南海南"},{value:2,text:"南海北"}],searchValue:"123123"}},onLoad:function(e){var t=this;this.showscore();var o=n.database();o.collection("coupons").get().then((function(n){t.coupon=n.result.data})).catch((function(n){console.log(n)}))},methods:{change:function(n){},search:function(n){t.showToast({title:"搜索："+n.value,icon:"none"})},showscore:function(){var e=this;t.getStorage({key:"user",success:function(t){e.userInfo.id=t.data.user._id;var o={_id:e.userInfo.id},u=n.database();u.collection("uni-id-users").where(o).get().then((function(n){e.newscore=n.result.data[0].new_score,e.u_id=n.result.data[0]._id})).catch((function(n){console.log(n)}))}})},exchange:function(n){var e=this;t.showModal({title:"重要提示",content:"是否要兑换此卷",cancelText:"取消",confirmText:"确定",success:function(o){o.confirm?e.duihuan(n):t.showToast({title:"您取消了兑换",icon:"none"})}})},duihuan:function(e){var o=this,u=e.c_score,c=this.newscore;if(u>c)t.showToast({title:"您的积分不够兑换此卷",icon:"none"});else{var i={_id:this.userInfo.id},a=c-u,r=n.database();r.collection("uni-id-users").where(i).update({new_score:a});var s={_id:e._id};r.collection("coupons").where(s).get().then((function(n){var e=o.u_id;r.collection("user_coupon").add({c_name:n.result.data[0].c_name,c_time:n.result.data[0].c_time,c_score:n.result.data[0].c_score,c_price:n.result.data[0].c_price,c_term:n.result.data[0].c_term,u_id:e}).then((function(n){}))})),t.showModal({title:"重要提示",content:"您已成功兑换此卷，已放入卡包",showCancel:!1,confirmText:"确定",success:function(n){n.confirm?t.redirectTo({url:"/pages/coupon/coupon"}):console.log("失败")}})}},goucoupon:function(){t.navigateTo({url:"/pages/coupon/user_coupon"})}}};e.default=o}).call(this,t("a9ff")["default"],t("543d")["default"])},"6e84":function(n,e,t){"use strict";(function(n){var e=t("4ea4");t("1fb8"),t("a9ff");e(t("66fd"));var o=e(t("7f72"));wx.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t("543d")["createPage"])},"7f72":function(n,e,t){"use strict";t.r(e);var o=t("f95c"),u=t("e6b6");for(var c in u)["default"].indexOf(c)<0&&function(n){t.d(e,n,(function(){return u[n]}))}(c);t("851f");var i=t("f0c5"),a=Object(i["a"])(u["default"],o["b"],o["c"],!1,null,"d25539ac",null,!1,o["a"],void 0);e["default"]=a.exports},"851f":function(n,e,t){"use strict";var o=t("a3f1"),u=t.n(o);u.a},a3f1:function(n,e,t){},e6b6:function(n,e,t){"use strict";t.r(e);var o=t("254a"),u=t.n(o);for(var c in o)["default"].indexOf(c)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(c);e["default"]=u.a},f95c:function(n,e,t){"use strict";t.d(e,"b",(function(){return u})),t.d(e,"c",(function(){return c})),t.d(e,"a",(function(){return o}));var o={uniDataSelect:function(){return t.e("uni_modules/uni-data-select/components/uni-data-select/uni-data-select").then(t.bind(null,"8a7c"))},uniSearchBar:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar")]).then(t.bind(null,"4179"))},uniRow:function(){return t.e("uni_modules/uni-row/components/uni-row/uni-row").then(t.bind(null,"d390"))},uniCol:function(){return t.e("uni_modules/uni-row/components/uni-col/uni-col").then(t.bind(null,"0f3c"))},uniSection:function(){return t.e("uni_modules/uni-section/components/uni-section/uni-section").then(t.bind(null,"2a9a"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"4fbd"))},uDivider:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(t.bind(null,"7aba"))}},u=function(){var n=this.$createElement,e=(this._self._c,t("e3f5"));this.$mp.data=Object.assign({},{$root:{m0:e}})},c=[]}},[["6e84","common/runtime","common/vendor"]]]);